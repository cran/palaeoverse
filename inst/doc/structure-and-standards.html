<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Contributing to palaeoverse: structure and standards</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Contributing to palaeoverse: structure and
standards</h1>



<div style="text-align: justify">
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>palaeoverse</code> R package is a community-driven software
library providing generic tools for palaeobiological analysis. The core
principles of palaeoverse are to: (1) streamline analyses, (2) enhance
code readability, and (3) improve reproducibility of results.</p>
<p>This document describes the essential structure and conventions of
the <code>palaeoverse</code> R package. Naturally, there are always
disagreements regarding best practices and conventions, and
<code>palaeoverse</code> is no exception. Despite this, all the
essentials in <code>palaeoverse</code> are encouraged to make the lives
of both the developer, and the user, easier. It is worth noting that the
core structure and conventions adopted in <code>palaeoverse</code> are
heavily influenced by Hadley Wickham and Jenny Bryan’s <a href="https://r-pkgs.org/index.html">R Packages</a> and the <a href="https://style.tidyverse.org/index.html">tidyverse style guide</a>,
which is currently also Google’s guide.<br />
<br></p>
<p><strong><em>“Good coding style is like correct punctuation: you can
manage without it, butitsuremakesthingseasiertoread.” – tidyverse style
guide</em></strong></p>
</div>
<div id="files" class="section level1">
<h1>Files</h1>
<p>File names should always be concise, meaningful and end in
<code>&#39;.R&#39;</code>. Avoid using special characters whenever possible
(i.e. stick to letters and numbers), and use <code>&#39;_&#39;</code> or
<code>&#39;-&#39;</code> instead of spaces in file names. The use of lowercase
is also strongly encouraged, and <strong>never</strong> have file names
that only differ in capitalization. <strong>Note:</strong> the preferred
separator is <code>&#39;_&#39;</code> to consist with the ‘lowercase snake_case’
convention for developing functions (more on that later!).<br />
<br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nein!</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Sup3rAw3sumFuncti0n.r</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Besser</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>super_awesome_function.R</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Das ist gut!</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>time_bins.R</span></code></pre></div>
</div>
<div id="r-style-guide" class="section level1">
<h1>R style guide</h1>
<p>We recommend using the following conventions to make your code easier
for us (and the community) to understand and use:</p>
<p><strong>Assigning:</strong> use arrows (&lt;-) rather than equals
sign to assign.</p>
<p><strong>Comments:</strong> please explain your code comprehensively
using comments (#) as this will help us to understand your intentions
and to review the code.</p>
<p><strong>Packages:</strong> please use as few external packages
(i.e. dependencies) as possible, as the package is more likely to break
when alterations are made to these; if your code uses packages, load
them all at the start of the script (i.e. in tutorials or examples).
This is more transparent for the user than having various packages
sprinkled throughout the code.</p>
<p><strong>Progress:</strong> if your code may take a long time to run
(more than a minute), include a progress bar such as
<code>&#39;txtProgressBar()&#39;</code> in your function.</p>
<p><strong>Sections:</strong> use lines of ‘-’ or ‘=’ to indicate
section breaks. It is hard to provide exact details on how long a
section break should be. However, we tend to think of them as paragraphs
in our code. <strong>Tip:</strong> In RStudio, you can use
<code>&#39;# SECTION NAME ###&#39;</code> to make a section which is interpreted
by the outline feature. You can also make subsections by adding more
<code>&#39;#&quot;</code> before the section name. If you are using RStudio, you
can also use the keyboard shortcut
<code>Cmd/Ctrl + Shift + R</code>.</p>
<p><strong>Spacing:</strong> add spaces to your code to make it more
human-readable.</p>
<p><strong>Objects:</strong> use object names that are short but
relevant to their contents, ideally in ‘lowercase snake_case’.</p>
<p><strong>Wrapping:</strong> break long commands into multiple lines,
conventionally no line should be longer than ~75–80 characters.</p>
<p><strong>Language:</strong> use plain English (British spelling
preferred, but not required) for your code and documentation.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nope!</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span>x<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Awesome!</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Often we might want to include data into palaeoverse. This might come
in the form of example datasets for testing functions (e.g. fossil
occurrences), reference datasets such as the Geological Timescale 2020,
or even data that is fundamental for a function to run. In palaeoverse’s
structure, we currently recognize four main ways of including data in
the package depending on its usage.</p>
<ul>
<li>Raw data</li>
<li>Internal data</li>
<li>Exported data</li>
<li>External data (preferred option)</li>
</ul>
<p>However, for the sake of file size efficiency, please only include
data and variables in your files which will be used by your function.
<strong>Note:</strong> in order to be released on CRAN, R packages must
be less than 5 MB in size. Please only include data that is absolutely
vital for your function. The preferred solution to including data into
palaeoverse functions is calling the data via an API or download URL
(i.e. external data).</p>
<div id="raw-data" class="section level2">
<h2>Raw data</h2>
<p>Raw data should always be included in <code>inst/extdata</code>. If
you want to include cleaned/processed data in <code>data/</code>, it is
generally a good idea to include the code used to process the raw data.
If you ever need to reproduce or update your cleaned data, this will
save you precious time. The code for processing your data should be
included in <code>data-raw/</code>. Strictly speaking, raw data does not
need to be documented. However, it is a good idea to include the
original source and version (including a download date) in your
code.</p>
</div>
<div id="internal-data" class="section level2">
<h2>Internal data</h2>
<p>Data you do not wish to directly make available to the user should be
saved as <code>R/sysdata.rda</code>. This is the best option for
pre-computed data tables that are needed for a function to run. Strictly
speaking internal data does not need to be documented. However, it is a
good idea to document the internal data in the function
documentation.</p>
</div>
<div id="exported-data" class="section level2">
<h2>Exported data</h2>
<p>Package data you wish to make available to the user should be stored
in <code>data/</code>. Each file in this directory should be either a
<code>&#39;.rda&#39;</code> or <code>&#39;.RData&#39;</code>. This file type is fast,
small and explicit. The most appropriate way to include exported data is
to use <code>usethis::use_data()</code>.</p>
<p>When using large datasets, we want to ensure that our files are not
bloated and taking up too much space on our users’ machines. As such,
you may want to experiment with the compression settings in
<code>usethis::use_data()</code>. Generally, <code>xz</code> and
<code>gzip</code> can create smaller files than the default
<code>bzip2</code>. You can also implement several ‘hacks’ to generate
smaller files which you may want to consider for large datasets
(depending on whether your data is sensitive to such changes). Data with
many decimal places consume a lot of memory, consider how many
significant figures are relevant for your data, and <code>round()</code>
accordingly. You can also experiment with your file size by multiplying
your data by X (e.g. 1,000) to remove decimal places altogether.
<strong>Note:</strong> Remember to undo any transformations when calling
or working with the data.</p>
</div>
<div id="external-data" class="section level2">
<h2>External data</h2>
<p>External data is the preferred approach for contributors to include
data into <code>palaeoverse</code> and will be required in almost all
cases. This is to ensure that the package does not become unnecessary
bloated to all users when the data can just be called by a download
link. Currently, external data are stored on a GitHub repo
(reconstruction files for <code>palaeorotate</code>). It is likely that
in the future this will be migrated elsewhere as GitHub is not a data
repository (hopefully a dedicated server when funding allows!). If you
wish to include external data, please get in touch with one of the
palaeoverse developers, and we can discuss what might be the best
solution.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generate temp directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#download files</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;www.goo.com&quot;</span>, <span class="at">destfile =</span> <span class="fu">paste0</span>(files, <span class="st">&quot;/mgoo.csv&quot;</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#run some kind function using the download</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#REMEMBER: remove downloaded files</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="at">x =</span> <span class="fu">paste0</span>(files, <span class="st">&quot;/&quot;</span>, <span class="fu">list.files</span>(files)))</span></code></pre></div>
</div>
<div id="data-documentation" class="section level2">
<h2>Data documentation</h2>
<p>Objects in <code>data/</code> are always exported by default, and
should be documented accordingly. In order to properly document data,
you must document the name of the dataset and save it in
<code>R/data</code>. For example, the documentation block used to
document GTS2020 is saved as <code>R/data.R</code> and is similar to the
following (simplified here):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Geological Time Scale 2020</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; A dataset of the Geological Time Scale 2020. Age data from:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  \url{https://stratigraphy.org/timescale/}.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Supplementary information is also included in the dataset for</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plotting functionality (e.g. GTS2020 colour scheme).</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @format A data frame with 189 rows and 20 variables:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \describe{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{index}{Index number for the order of all intervals in the dataset}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{stage_number}{Index number for stages}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{series_number}{Index number for series}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{system_number}{Index number for system}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{interval_name}{Names of intervals in the dataset}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   ...</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @section References:</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Gradstein, F.M., Ogg, J.G., Schmitz, M.D. and Ogg, G.M. eds. (2020).</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Geologic time scale 2020. Elsevier.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @source Compiled by Lewis A. Jones. See item descriptions for details.</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;GTS2020&quot;</span></span></code></pre></div>
</div>
<div id="what-does-it-mean-to-document-your-data" class="section level2">
<h2>What does it mean to document your data?</h2>
<p>Documenting your data is to provide a thorough description of the
data and any information relevant to understanding it. Good
documentation is key to reproducible science, and will also help us to
ensure that we acknowledge all data collators who have provided data for
the <code>palaeoverse</code> package. When providing us with datasets,
please give the following information:</p>
<p><strong>Author(s):</strong> Who collected the data, and prepared its
current format? Please provide citations if relevant. Have the authors
given permission for the dataset to be included in the
<code>palaeoverse</code> package?</p>
<p><strong>Description:</strong> Brief description of the dataset.</p>
<p><strong>Provenance:</strong> When and how was the data collected?
When was the dataset finalised in its current form?</p>
<p><strong>Size:</strong> Please state the full, uncompressed size of
the file.</p>
<p><strong>Variables:</strong> Describe each of the columns in your
dataset, providing as much information as you can on the full name of
the variable, data type (e.g. continuous, discrete, categoric, etc.),
units, and how it was collected.</p>
</div>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<div id="conventions" class="section level2">
<h2>Conventions</h2>
<p>Functions are saved as <code>&#39;.R&#39;</code> files in the
<code>&#39;R&#39;</code> folder. The name of the file needs to correspond to the
function, e.g. the file <code>time_bins.R</code> contains the function
<code>time_bins()</code>. Function names and arguments should be
informative and aim to keep in line with available functions in
<code>palaeoverse</code>. For example, all functions that bin data,
whether it be by time or space, start with <code>bin_</code>, whereas
taxonomic-related functions start with <code>tax_</code>
(e.g. <code>tax_unique</code>, <code>tax_check</code>). Where possible,
argument names should also consist with functions in the package. For
example, if a function requires an occurrence dataframe as input, the
argument name should be <code>occdf</code>. It is difficult to give a
complete static summary of all the conventions as
<code>palaeoverse</code> will undoubtedly evolve over time. We also wish
to remain flexible for contributors, provided that it does not
compromise the user-friendliness of the package. We welcome contributors
to check through the source code of <code>palaeoverse</code> for
function examples.</p>
</div>
<div id="documentation" class="section level2">
<h2>Documentation</h2>
<p>For documentation, we use <a href="https://roxygen2.r-lib.org">roxygen2</a>. The title, a brief
description, and every argument (including the input class and default
input) and the output of the function need to be documented in
<code>roxygen2</code> style, for example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; An exemplary function</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This function is used to demonstrate the documentation of functions.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param example \code{character}. Arguments are the function inputs.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param another_example \code{logical}. All arguments need to be documented.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A \code{list} is returned as output in this example function.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @details Describe more details if necessary, and list sources if applicable.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @section Developer:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Your name</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @section Reviewer:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Name(s)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; #Show off the example function</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; example_function(example = “documentation”, another_example = TRUE)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span></code></pre></div>
<p>Add the <code>&#39;@export&#39;</code> namespace tag to make the function
available.</p>
<p>To get started with <code>roxygen2</code>, set your working directory
to the package directory, or to the directory where you store your
function as a <code>&#39;.R&#39;</code> file. The R command
<code>devtools::document()</code> creates a ‘man’ folder in the
directory, which contains a <code>&#39;.Rd&#39;</code> file corresponding to
your documented function. Opening that file in RStudio, you can create a
preview to see what the documentation looks like. After you have
implemented changes, rebuild your documentation file with Ctrl+Shift+B
or <code>devtools::document()</code>.</p>
</div>
<div id="efficiency" class="section level2">
<h2>Efficiency</h2>
<p>When possible, you should make coding decisions which will ensure
that your code is maximally efficient - this could make a big difference
to users who want to apply your function to a large dataset. A few
general examples include:</p>
<ul>
<li>Using functions from the <code>&#39;apply&#39;</code> family can be faster
than for-loops. However, a for-loop is almost always more
reader-friendly, so try to balance the two!</li>
<li>Storing objects as lists, or lists of lists, rather than data frames
inside functions</li>
<li>Vectorise, when possible. This way a function can operate on all
elements of a vector without needing to loop through each element.</li>
<li>Avoiding using <code>rbind()</code> and <code>cbind()</code> to
compile objects row-wise or column-wise within for-loops; specifying the
row or column number using the iteration number is usually a faster
alternative.</li>
</ul>
<p>However, please don’t let this deter you - we welcome submissions
from R users of all experience levels, and our team of in-house code
evaluators can help you with any concerns about efficiency.</p>
</div>
<div id="error-messages" class="section level2">
<h2>Error messages</h2>
<p>To ensure that the functions are used appropriately, error messages
should be generated when the function is receiving input it is not
designed for. Error messages consist of a brief description of what went
wrong. Sometimes it makes sense to specify where it went wrong, and what
kind of input was expected. Optionally, error messages can include hints
to guide the user towards correct input.</p>
<p>Examples of error messages include</p>
<ul>
<li>input of the wrong format,
e.g. <code>“Error: &#39;x&#39; must be a numeric vector.”</code></li>
<li>input of the wrong dimension,
e.g. <code>“Error: &#39;x&#39; must be a data.frame with two columns.”</code></li>
<li>input without mandatory names,
e.g. <code>“Error: &#39;x&#39; does not have a column &#39;stage&#39;.</code>
<code>&#39;x&#39; must be a data.frame with the columns &#39;stage&#39; and &#39;age&#39;.”</code></li>
</ul>
<p>To implement error messages in R, the <code>stop()</code> function
can be used:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate error message</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(x)) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Error: &#39;x&#39; must be a numeric vector.&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="warning-messages" class="section level2">
<h2>Warning messages</h2>
<p>In general, we try to minimise the use of warning messages in
<code>palaeoverse</code> as these can be easily ignored by the user, or
completely skipped in pipeline analyses (<a href="https://www.r-bloggers.com/2012/05/a-warning-about-warning/">see
more?</a>). However, as with most things in life, there is a time and a
place. So, while the use of <code>warning()</code> is generally
discouraged if throwing an error will suffice, we do allow the use of
warning messages in <code>palaeoverse</code>, where appropriate. Warning
messages can be useful for providing additional information to the user
about function output. For example, in the <code>palaeorotate</code>
function we provide a warning to users if one or more points could not
be reconstructed due to the georeferenced plate not existing at the
desired time of reconstruction.</p>
<p>To implement warning messages in R, the <code>warning()</code>
function can be used:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate warning message</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(x)) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;Warning: &#39;x&#39; must be a numeric vector.&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="tests" class="section level2">
<h2>Tests</h2>
<p>Testing is perhaps one of the most important parts of developing a
function. If you have not already, we recommend reading through Chapter
12–Testing of <a href="https://r-pkgs.org/testing-basics.html#test-organisation">‘R
packages’</a> before continuing here as <code>palaeoverse</code> follows
this guidance.</p>
<p>Before a function can be added to <code>palaeoverse</code>, it needs
to go through formal testing. This is required as hopefully your
function will be very popular, and we need to ensure that it behaves as
expected to avoid any issues. To do so, we make use of the R package
<code>testthat</code>.</p>
<p>The initial setup for function testing with <code>testthat</code> is
already established in palaeoverse, under the directory
<code>&#39;tests/testthat/&#39;</code>. The organisation of test files must
match that of <code>&#39;R/&#39;</code> files in <code>palaeoverse</code>. For
example, the function <code>time_bins()</code> is saved as
<code>time_bins.R</code> in the <code>R/</code> directory, and has an
associated test file of <code>&#39;test-time_bins.R&#39;</code> in the
<code>&#39;tests/testthat&#39;</code> directory. This ensures that associated
function testing is clear.</p>
<p><strong>Tip:</strong> the <code>usethis</code> package provides a
helpful pair of functions for creating/alternating between these
files:</p>
<ul>
<li><code>usethis::use_r()</code></li>
<li><code>usethis::use_test()</code></li>
</ul>
<p>Make sure to create enough tests within your <code>.R</code> file to
cover all of the possible variants of a function. This includes creating
tests that cover most or all optional arguments and the majority of
options for those arguments (and the required arguments). Remember, even
if you personally would not use a function for a particular reason, you
must attempt to cover the majority of edge cases that may arise that are
allowed by the function.</p>
<p>Related tests should be bundled within <code>test_that()</code> calls
combined with strings of text to identify the broad reason for each
bundle of tests (e.g., testing a function works with a particular type
of data). Finally, if tests rely on data or packages outside of the
<code>palaeoverse</code> community must have, they should be skipped if
those data or packages are not available.</p>
<p>Ultimately, we aim to have &gt;90% code coverage (95% preferred),
which means 90% of the lines of code in our codebase should be tested by
at least one test. Pushing code to GitHub will trigger a code coverage
check, which will alert you as to whether you need to write more
tests.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test expected outcome is equal to actual outcome</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;time_bins() works&quot;</span>, {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(<span class="fu">time_bins</span>(<span class="at">interval =</span> <span class="fu">c</span>(<span class="st">&quot;Maastrichtian&quot;</span>))), <span class="dv">1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
</div>
<div id="contributing-to-palaeoverse" class="section level1">
<h1>Contributing to palaeoverse</h1>
<p>At <code>palaeoverse</code> we have adopted a set of <a href="https://palaeoverse.palaeoverse.org/articles/structure-and-standards.html">structures
and standards</a> to follow for contributing to the development of
<code>palaeoverse</code>. If you would like to contribute to the
<code>palaeoverse</code> toolkit, we strongly advise reading this
document first. If you plan to contribute a function to
<code>palaeoverse</code>, you should first raise an <a href="https://github.com/palaeoverse-community/palaeoverse/issues">issue</a>
via the GitHub repository (see below). This way the development team can
assess whether the function is suitable or needed in the
<code>palaeoverse</code> toolkit prior to submission.</p>
<div id="git-and-github" class="section level2">
<h2>Git and GitHub</h2>
<p>We use git via Github <a href="https://github.com/palaeoverse-community">(<strong>palaeoverse-community</strong>)</a>
to manage our R code and data. If you are not familiar with these tools,
there are some excellent free resources available online:</p>
<ul>
<li><a href="https://github.com/llendway/github_for_collaboration/blob/master/github_for_collaboration.md">Setting
up git within RStudio (short)</a></li>
<li><a href="https://www.youtube.com/watch?v=megZYkCLMA4">Collaborating
in R with git and GitHub (50 min. youtube video)</a></li>
<li><a href="https://rfortherestofus.com/2021/02/how-to-use-git-github-with-r/">Git
and GitHub and R packages (medium length)</a></li>
<li><a href="https://happygitwithr.com/">A comprehensive guide to git
and R (very long)</a></li>
</ul>
</div>
<div id="how-to-contribute" class="section level2">
<h2>How to contribute</h2>
<div id="minor-changes" class="section level3">
<h3>Minor changes</h3>
<p>You can fix typos, spelling mistakes, or grammatical errors in the
documentation directly on GitHub, provided it is done so in the source
file. This means you’ll need to edit roxygen2 comments in the
<code>.R</code> file, not the <code>.Rd</code> file.</p>
</div>
<div id="substantial-changes" class="section level3">
<h3>Substantial changes</h3>
<p>If you would like to make a substantial change, you should first file
an issue and make sure someone from the development team agrees that
it’s needed. If you’ve found a bug, please file an issue that
illustrates the bug with a reproducible example.</p>
</div>
<div id="pull-request-process" class="section level3">
<h3>Pull request process</h3>
<p>You (the contributor) should clone the desired repository (i.e. <a href="https://github.com/palaeoverse-community/palaeoverse">the
palaeoverse R package</a>) to your personal computer. Before changes are
made, you should switch to a new git branch (i.e., not the main branch).
When your changes are complete, you can submit your changes for merging
via a <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">pull
request</a> (“PR”) on GitHub. Note that a complete pull request should
include a succinct description (<a href="https://github.com/palaeoverse-community/palaeoverse/blob/main/pull_request_template.md">see
function template</a>) of what the code changes do, proper documentation
(via <a href="https://roxygen2.r-lib.org">roxygen2</a>), and unit tests
(via <code>testthat</code>). Only the description is required for the
initial pull request and code review (see below), but pull requests will
not be merged until they contain complete documentation and tests.</p>
<p>If you are not comfortable with git/GitHub, you can reach out to one
of the core developers (<a href="https://github.com/palaeoverse-community/palaeoverse">see
collaborators</a>) via email and they can make a pull request on your
behalf. However, you will be expected to respond to any reviewer
comments on GitHub (see below).</p>
<p>If you don’t feel comfortable implementing changes yourself, you can
submit a bug report or feature request as a GitHub issue in the proper
repository (e.g. <a href="https://github.com/palaeoverse-community/palaeoverse/issues">palaeoverse
issues</a>).</p>
</div>
</div>
<div id="code-review" class="section level2">
<h2>Code review</h2>
<p>All pull requests must be reviewed by two core developers of
<code>palaeoverse</code> (<a href="https://github.com/palaeoverse-community/palaeoverse">see
collaborators</a>) before merging. The review process will ensure that
contributions 1) meet the standards and expectations as described above,
2) successfully perform the functions that they claim to perform, and 3)
don’t break any other parts of the codebase.</p>
<p>Submitting a pull request to the <code>palaeoverse</code> package
will automatically initiate an <a href="https://r-pkgs.org/check.html">R
CMD check</a>, <a href="https://lintr.r-lib.org/index.html">lintr
check</a>, and <a href="https://github.com/r-lib/covr">test coverage
check</a> via GitHub Actions. While these checks will conduct some
automatic review to ensure the package has not been broken by the new
code and that the code matches the style guide (see above), a manual
review is still required before the pull request can be merged.</p>
<p>Reviewers may have questions while reviewing your pull request. You
are expected to respond to any of these questions via GitHub. If fixes
and/or changes are required, you are expected to make these changes. If
the required changes are minor enough, reviewers may make them for you,
but this should not be expected. If you have any questions or lack the
background to make the required changes, you should work with the
reviewer to determine a plan of attack.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
